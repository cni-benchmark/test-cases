apiVersion: v1
kind: Pod
metadata:
  name: server
  labels:
    iperf3: server
spec:
  containers:
    - name: server
      image: iperf3
      command: ["/bin/bash", "-euo", "pipefail", "-c"]
      args:
        - |-
          iperf3 --version
          iperf3 --server --port=${PORT:-5201} ${ARGS:-}
      startupProbe:
        periodSeconds: 1
        tcpSocket:
          port: tcp
      ports:
        - name: tcp
          containerPort: 5201
          protocol: TCP
        - name: udp
          containerPort: 5201
          protocol: UDP
